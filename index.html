<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>서울시 가로쓰레기통 위치 지도</title>
    <link rel="stylesheet" href="styles.css" />
    <!-- 아이콘 라이브러리 추가 -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- 네이버 지도 API -->
    <script
      type="text/javascript"
      src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=aqo1ps0ggk"
    ></script>
    <script
      type="text/javascript"
      src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=aqo1ps0ggk&submodules=geocoder"
    ></script>
    <script src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=aqo1ps0ggk&submodules=clusterer"></script>
    <!-- Google Fonts - Inconsolata 추가 -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        overflow: hidden;
      }

      .app-container {
        display: flex;
        flex-direction: column;
        height: 100vh;
        width: 100%;
      }

      /* 광고 컨테이너 스타일 */
      .ad-container {
        width: 100%;
        height: 70px;
        background-color: #f0f0f0;
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
        color: #888;
        z-index: 5;
      }

      /* 지도 컨테이너 스타일 */
      .map-container {
        position: relative;
        width: 100%;
        flex: 1; /* 남은 공간 모두 차지 */
        overflow: hidden;
      }

      .map {
        width: 100%;
        height: 100%;
      }

      .trash-count-overlay span {
        color: #188fff;
        font-weight: bold;
      }

      /* 햄버거 메뉴 버튼 */
      .menu-button {
        position: absolute;
        top: 15px;
        right: 15px;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: white;
        border: none;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        cursor: pointer;
        transition: all 0.2s ease;
        z-index: 10;
      }

      .menu-button:hover {
        background-color: #f5f5f5;
      }

      .menu-button i {
        font-size: 18px;
        color: #333;
      }

      /* 현위치 버튼 */
      .current-location-button {
        position: absolute;
        bottom: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
        background-color: white;
        border: none;
        border-radius: 50%;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        color: #188fff;
        cursor: pointer;
        z-index: 10;
        transition: all 0.2s ease;
      }

      .current-location-button:hover {
        background-color: #f5f5f5;
      }

      .current-location-button:active {
        transform: scale(0.95);
      }

      .current-location-button.active {
        background-color: #188fff;
        color: white;
      }

      /* 상태 바 */
      .footer {
        background-color: rgba(255, 255, 255, 0.9);
        padding: 8px 15px;
        font-size: 12px;
        color: #666;
        border-top: 1px solid #eee;
        z-index: 5;
      }

      .status-bar {
        display: flex;
        justify-content: space-between;
      }

      /* 로딩 인디케이터 */
      .loading-indicator {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 20px;
        border-radius: 10px;
        display: none;
        flex-direction: column;
        align-items: center;
        z-index: 100;
      }

      .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 1s ease-in-out infinite;
        margin-bottom: 10px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* 마커 정보 창 스타일 */
      .marker-info-window {
        display: none;
        position: absolute;
        z-index: 1000;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        padding: 12px;
        max-width: 300px;
        font-size: 14px;
        transition: opacity 0.3s ease;
        opacity: 0;
        pointer-events: auto; /* 클릭 이벤트 허용 */
      }

      .marker-info-window.show {
        display: block !important; /* !important로 강제 적용 */
        opacity: 1 !important;
      }

      .marker-info-window h4 {
        margin: 0 0 8px 0;
        font-size: 16px;
        font-weight: bold;
        color: #333;
      }

      .marker-info-window .info-address {
        margin-bottom: 8px;
      }

      .marker-info-window .info-address p {
        margin: 2px 0;
        color: #666;
      }

      .marker-info-window .detail-link {
        display: block;
        text-align: right;
        color: #188fff;
        text-decoration: none;
        margin-top: 8px;
      }

      /* 정보창 화살표 추가 */
      .marker-info-window::before {
        content: "";
        position: absolute;
        top: -10px;
        left: 50%;
        transform: translateX(-50%);
        border-width: 0 10px 10px 10px;
        border-style: solid;
        border-color: transparent transparent white transparent;
      }

      /* 사이드 메뉴 */
      .side-menu {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        z-index: 1000;
        display: flex;
        transform: translateX(100%);
        transition: transform 0.3s ease;
      }

      .side-menu.show {
        transform: translateX(0);
      }

      .side-menu-content {
        width: 280px;
        background-color: white;
        box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        overflow-y: auto;
      }

      .side-menu-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        border-bottom: 1px solid #eee;
      }

      .side-menu-header h2 {
        margin: 0;
        font-size: 20px;
      }

      .menu-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .menu-list li {
        padding: 15px 20px;
        border-bottom: 1px solid #eee;
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
      }

      .menu-list li:hover {
        background-color: #f5f5f5;
      }

      .district-filter {
        padding: 15px 20px;
      }

      .district-filter h3 {
        margin: 0 0 10px 0;
        font-size: 16px;
      }

      .district-filter select {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }

      .side-menu-overlay {
        flex: 1;
        background-color: rgba(0, 0, 0, 0.5);
      }

      /* GPS 권한 요청 모달 */
      .gps-request-modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .gps-request-modal.show {
        opacity: 1;
        visibility: visible;
      }

      .gps-request-content {
        background-color: white;
        border-radius: 12px;
        padding: 24px;
        width: 80%;
        max-width: 400px;
        text-align: center;
      }

      .gps-request-content h3 {
        margin-bottom: 16px;
        font-size: 18px;
      }

      .gps-request-content p {
        margin-bottom: 24px;
        font-size: 14px;
        line-height: 1.5;
        color: #666;
      }

      .gps-request-buttons {
        display: flex;
        justify-content: space-between;
      }

      .gps-request-buttons button {
        flex: 1;
        padding: 12px;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
      }

      .gps-request-buttons button.cancel {
        background-color: #f5f5f5;
        color: #666;
        margin-right: 8px;
      }

      .gps-request-buttons button.confirm {
        background-color: #188fff;
        color: white;
        margin-left: 8px;
      }
    </style>
  </head>
  <body>
    <div class="app-container">
      <!-- 상단 구글 애드센스 배너 영역 -->
      <div class="ad-container">
        <!-- 구글 애드센스 코드가 여기에 들어갑니다 -->
        상단 광고 영역
      </div>

      <!-- 지도 영역 -->
      <div class="map-container">
        <!-- 지도가 표시될 영역 -->
        <div id="map" class="map"></div>

        <!-- 10km 이내 쓰레기통 개수 (지도 위에 표시) -->
        <div class="trash-count-overlay">
          10km 이내 <span id="nearbyTrashCount">0</span>개
        </div>

        <!-- 햄버거 메뉴 버튼 (지도 위에 표시) -->
        <button id="menuButton" class="menu-button">
          <i class="fas fa-bars"></i>
        </button>

        <!-- 로딩 인디케이터 -->
        <div id="loadingIndicator" class="loading-indicator">
          <div class="spinner"></div>
          <p>데이터를 불러오는 중...</p>
        </div>

        <!-- 현위치 버튼 -->
        <button id="currentLocationButton" class="current-location-button">
          <i class="fas fa-crosshairs"></i>
        </button>

        <!-- 마커 클릭 시 표시되는 작은 정보 창 -->
        <div id="markerInfoWindow" class="marker-info-window">
          <h4 id="infoTitle">위치 정보</h4>
          <div class="info-address">
            <p id="infoAddress">- m</p>
            <p id="infoDetailAddress">상세 주소</p>
          </div>
          <p id="infoTrashType">쓰레기통 유형</p>
          <a href="#" id="infoDetailLink" class="detail-link">detail →</a>
        </div>
      </div>

      <!-- 하단 광고 영역 -->
      <div class="ad-container">
        <!-- 구글 애드센스 코드가 여기에 들어갑니다 -->
        하단 광고 영역
      </div>

      <!-- 하단 상태 바 -->
      <footer class="footer dev-only">
        <div class="status-bar">
          <span id="totalCount">총 0개의 쓰레기통</span>
          <span id="visibleCount">화면에 0개 표시 중</span>
        </div>
      </footer>
    </div>

    <!-- 사이드 메뉴 (처음에는 숨겨져 있음) -->
    <div id="sideMenu" class="side-menu">
      <div class="side-menu-content">
        <!-- 기본 메뉴 화면 -->
        <div id="mainMenuView" class="menu-view">
          <div class="side-menu-header">
            <span class="logo-text">BinFinder</span>
            <button id="closeMenu" class="close-button">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="menu-container">
            <ul class="menu-list">
              <li id="aboutBinFinder">BinFinder 소개</li>
              <li id="serviceTerms">서비스 이용약관</li>
              <li>위치기반서비스 이용약관</li>
              <li>개인정보 처리방침</li>
            </ul>
          </div>
        </div>

        <!-- BinFinder 소개 화면 -->
        <div id="aboutView" class="menu-view about-view">
          <div class="side-menu-header">
            <button id="backToMenu" class="back-button">
              <i class="fas fa-arrow-left"></i>
            </button>
            <span class="header-title">BinFinder</span>
            <button id="closeMenuFromAbout" class="close-button">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="about-content">
            <p>BinFinder는 한국 여행자들의 더욱 쾌적한 여행을 돕고자<br>각 지역의 길거리 쓰레기통 위치를 제공하고 있습니다.</p>
            <p>단, 일부 지역의 위치 정보는 정부 단체의 데이터 제공 제한으로<br>인하여 표시되지 않을 수 있습니다.</p>
          </div>
        </div>

        <!-- 서비스 이용약관 화면 -->
        <div id="termsView" class="menu-view terms-view">
          <div class="side-menu-header">
            <button id="backToMenuFromTerms" class="back-button">
              <i class="fas fa-arrow-left"></i>
            </button>
            <span class="header-title">서비스 이용약관</span>
            <button id="closeMenuFromTerms" class="close-button">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="terms-content">
            <div class="terms-section">
              <h3>제1조 (서비스 개요)</h3>
              <p>본 서비스는 사용자의 현재 위치를 기준으로 주변의 공공 휴지통 위치를 지도상에 표시하는 웹 기반 위치 안내 서비스입니다. 가입 절차 없이 누구나 이용할 수 있으며, 위치정보 접근에 대한 동의가 필요한 경우 이에 대한 안내가 제공됩니다.</p>
            </div>

            <div class="terms-section">
              <h3>제2조 (위치정보 이용)</h3>
              <p>1. 본 서비스는 위치기반 기능을 제공하기 위해 사용자의 단말기 위치정보 접근 권한을 요청합니다.</p>
              <p>2. 위치정보는 실시간 안내용으로만 사용되며, 별도로 저장하거나 외부에 제공되지 않습니다.</p>
              <p>3. 사용자는 단말기 설정을 통해 위치정보 제공을 거부할 수 있으며, 이 경우 일부 기능이 제한될 수 있습니다.</p>
            </div>

            <div class="terms-section">
              <h3>제3조 (광고 및 제3자 정보 수집)</h3>
              <p>1. 본 서비스는 Google AdSense를 통해 광고를 게재합니다.</p>
              <p>2. 광고 제공 과정에서 Google 등 제3자 서비스 제공자가 쿠키, IP 주소, 대략적 위치 등 정보를 자동 수집할 수 있으며, 이에 대한 사항은 Google의 개인정보처리방침에 따릅니다.</p>
              <p>3. 운영자는 광고와 관련된 개인정보 수집 및 처리를 직접 하지 않습니다.</p>
            </div>

            <div class="terms-section">
              <h3>제4조 (면책사항)</h3>
              <p>1. 본 서비스에 표시되는 휴지통 위치 정보는 공공 데이터를 기반으로 하며, 실제 현황과 차이가 있을 수 있습니다.</p>
              <p>2. 위치 정확도는 사용자의 기기 상태, GPS 환경 등에 따라 오차가 발생할 수 있습니다.</p>
              <p>3. 운영자는 정보의 정확성, 완전성, 최신성에 대해 법적 책임을 지지 않으며, 서비스 이용으로 인한 직·간접적 피해에 대해 책임을 지지 않습니다.</p>
            </div>

            <div class="terms-section">
              <h3>제5조 (문의처)</h3>
              <p>서비스 관련 문의는 아래 이메일로 연락 주시기 바랍니다.</p>
              <p>운영자: 안소용</p>
              <p>이메일: <a href="mailto:whiteyong2@gmail.com">whiteyong2@gmail.com</a></p>
            </div>

            <div class="terms-footer">
              <div class="effective-date">
                <h4>시행일자</h4>
                <p>공고일자: 2025년 5월 31일</p>
                <p>시행일자: 2025년 6월 15일</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id="menuOverlay" class="side-menu-overlay"></div>
    </div>

    <!-- GPS 권한 요청 모달 -->
    <div id="gpsRequestModal" class="gps-request-modal">
      <div class="gps-request-content">
        <h3>#(URL) 이(가) 사용자의 위치 정보를 사용하려고 합니다.</h3>
        <p>
          웹(브라우저)에서 현재 사용자의 정확한 위치에 대한 접근 권한이 있기
          때문에, 이 웹사이트가 사용자의 정확한 위치를 사용합니다.
        </p>
        <div class="gps-request-buttons">
          <button class="cancel">허용 안함</button>
          <button class="confirm">허용</button>
        </div>
      </div>
    </div>

    <script src="/public/markers.js"></script>
    <script src="/public/script.js"></script>

    <!-- 추가 JavaScript 코드 - 근처 쓰레기통 개수 업데이트 -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // 기존 script.js에 다음 함수를 추가하거나 여기서 정의
        function updateNearbyTrashCount() {
          // 현재 위치를 기준으로 10km 이내의 쓰레기통 개수 계산
          if (currentLocationMarker && markers.length > 0) {
            const currentPos = currentLocationMarker.getPosition();
            let count = 0;

            markers.forEach((markerObj) => {
              const markerPos = markerObj.marker.getPosition();
              const distance = naver.maps.Service.getDistance(
                currentPos,
                markerPos
              );

              // 10km = 10000m 이내인지 확인
              if (distance <= 10000) {
                count++;
              }
            });

            // 개수 업데이트
            document.getElementById("nearbyTrashCount").textContent = count;
          }
        }

        // 위치가 업데이트될 때마다 근처 쓰레기통 개수 업데이트
        // 이 부분은 script.js의 위치 업데이트 함수에 추가해야 합니다
        // 여기서는 예시로만 제공합니다

        // 기존 코드에 이 함수 호출을 추가해야 합니다:
        // 1. 현위치 마커가 생성되거나 업데이트될 때
        // 2. 새로운 마커가 추가될 때
      });
    </script>
  </body>
</html>
